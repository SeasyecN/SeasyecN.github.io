---
// src/components/RetroBackground.astro
---
<canvas id="retro-bg" class="fixed top-0 left-0 w-full h-full -z-10"></canvas>

<script>
  const canvas = document.getElementById('retro-bg');
  const ctx = canvas.getContext('2d');

  let width, height;
  let time = 0;

  // Configuration from sample.html
  const COLORS = {
      bg: '#f3e5d0',       // 复古米色背景
  };

  function resize() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
  }

  function drawGrid() {
      ctx.strokeStyle = 'rgba(0, 0, 0, 0.05)';
      ctx.lineWidth = 1;
      const gridSize = 40;
      // Parallax scroll effect
      const offsetY = (time * 10) % gridSize;

      for (let x = 0; x < width; x += gridSize) {
          ctx.beginPath();
          ctx.moveTo(x, 0);
          ctx.lineTo(x, height);
          ctx.stroke();
      }
      for (let y = -gridSize; y < height; y += gridSize) {
          ctx.beginPath();
          ctx.moveTo(0, y + offsetY);
          ctx.lineTo(width, y + offsetY);
          ctx.stroke();
      }
  }

  function drawScanlines() {
      ctx.fillStyle = "rgba(18, 16, 16, 0.1)";
      for (let i = 0; i < height; i += 4) {
          ctx.fillRect(0, i, width, 1);
      }
      // Vignette
      const gradient = ctx.createRadialGradient(width/2, height/2, height/3, width/2, height/2, height);
      gradient.addColorStop(0, "rgba(0,0,0,0)");
      gradient.addColorStop(1, "rgba(0,0,0,0.4)");
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, width, height);
  }

  function animate() {
    requestAnimationFrame(animate);
    time += 0.05;

    // 1. Clear with background color
    ctx.fillStyle = COLORS.bg;
    ctx.fillRect(0, 0, width, height);

    // 2. Draw Effects
    drawGrid();
    drawScanlines();
  }

  window.addEventListener('resize', resize);
  resize();
  animate();
</script>